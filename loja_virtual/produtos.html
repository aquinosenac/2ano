<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Produtos - TechTrust</title>
  <link rel="stylesheet" href="css/style.css">

  <!-- Firebase + scripts -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

  <script src="firebase.js"></script>
  <script src="auth.js"></script>
</head>
<body>
  <header>
    <div class="container header-content">
      <a href="home.html" class="logo">TechTrust</a>
      <nav>
        <a href="home.html" class="btn btn-ghost">Home</a>
        <a href="produtos.html" class="btn btn-ghost">Produtos</a>
        <a href="admin.html" class="btn btn-ghost">Admin</a>
        <a href="carrinho.html" class="btn btn-primary cart-btn">
          <span class="cart-badge" style="display:none;">0</span>
        </a>
      </nav>
    </div>
  </header>

  <div class="container" style="padding-top:2rem; padding-bottom:2rem;">
    <div class="mb-4">
      <h1>Nossos Produtos</h1>
      <p style="color:var(--text-light)">Encontre os melhores produtos de tecnologia</p>
    </div>

    <div class="filters">
      <div class="search-box">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <circle cx="11" cy="11" r="8"></circle>
          <path d="m21 21-4.35-4.35"></path>
        </svg>
        <input id="searchInput" type="text" placeholder="Buscar produtos..." onkeyup="filterProducts()" />
      </div>

      <div id="categoryButtons" class="filter-buttons"></div>
    </div>

    <div id="resultCount" style="margin-bottom: .5rem; color:var(--text-light);"></div>

    <div id="productsList" class="products-grid"></div>
  </div>

  <footer>
    <div class="container">
      <p>&copy; 2025 TechTrust. Todos os direitos reservados.</p>
    </div>
  </footer>

  <script src="js/storage.js"></script>

  <script>
    let allProducts = [];
    let selectedCategory = 'Todas';

    async function loadProducts() {
      allProducts = await firebaseApi.listProductsFirestore();
      renderCategories();
      filterProducts();
    }

    function renderCategories() {
      const categories = ['Todas', ...new Set(allProducts.map(p => p.category || 'Sem categoria'))];
      const container = document.getElementById('categoryButtons');
      container.innerHTML = categories.map(c => `
        <button class="btn ${selectedCategory === c ? 'btn-primary' : 'btn-outline'}" onclick="selectCategory('${c}')">${c}</button>
      `).join('');
    }

    function selectCategory(cat) {
      selectedCategory = cat;
      renderCategories();
      filterProducts();
    }

    function filterProducts() {
      const searchTerm = document.getElementById('searchInput').value.toLowerCase();
      let filtered = allProducts;

      if (selectedCategory !== 'Todas') {
        filtered = filtered.filter(p => (p.category || 'Sem categoria') === selectedCategory);
      }

      if (searchTerm) {
        filtered = filtered.filter(p => (p.name || '').toLowerCase().includes(searchTerm) || (p.description || '').toLowerCase().includes(searchTerm));
      }

      renderProducts(filtered);
