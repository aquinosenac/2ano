<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Painel do Administrador</title>
  <link rel="stylesheet" href="../style.css">
  <script src="https://www.gstatic.com/firebasejs/10.5.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.5.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.5.0/firebase-firestore-compat.js"></script>
  <script src="../firebase-config.js"></script>
</head>
<body>

  <div class="dashboard-container">
    <h2 class="dashboard-title">Gerenciar Usuários</h2>
    <div id="listaUsuarios" class="reserva-list"></div>
  </div>

<script>
const auth = firebase.auth();
const db = firebase.firestore();

auth.onAuthStateChanged(async user => {
  if (!user) return location.href = "../login-cadastro/login.html";
  const docUser = await db.collection("usuarios").doc(user.uid).get();
  const cargo = docUser.exists ? docUser.data().cargo : "usuario";
  if (cargo !== "admin") return location.href = "../usuário.html";

  const lista = document.getElementById("listaUsuarios");

  db.collection("usuarios").onSnapshot(snapshot => {
    lista.innerHTML = "";
    snapshot.forEach(doc => {
      const u = doc.data();
      const card = document.createElement("div");
      card.className = "reserva-card";
      card.innerHTML = `
        <div class="reserva-info">
          <strong>${u.nome || doc.id}</strong>
          <span>${u.email || ""}</span>
          <span class="reserva-status">${u.cargo}</span>
        </div>
        <div class="reserva-actions">
          <select class="cargoSelect">
            <option value="usuario" ${u.cargo==="usuario"?"selected":""}>Usuário</option>
            <option value="gerente" ${u.cargo==="gerente"?"selected":""}>Gerente</option>
            <option value="admin" ${u.cargo==="admin"?"selected":""}>Admin</option>
          </select>
        </div>
      `;
      const select = card.querySelector(".cargoSelect");
      select.onchange = () => db.collection("usuarios").doc(doc.id).update({ cargo: select.value });
      lista.appendChild(card);
    });
  });
});
</script>

</body>
</html>
